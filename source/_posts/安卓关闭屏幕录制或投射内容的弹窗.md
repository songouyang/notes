---
title: 安卓关闭屏幕录制或投射内容的弹窗
comments: true
mathjax: false
toc: false
abbrlink: 26163
date: 2020-11-29 13:52:57
tags:
categories: 软件技巧
thumbnail:
cover: /data/thumbnails/26163.png
---

玩和平精英或者王者荣耀等游戏，开启精彩时刻录制后，每次进入游戏时都需要点击「要开始使用录制或投射内容」的确认框，极度影响开局的体验。自从安卓 10 版本之后，每次软件使用屏幕投射的功能时，只有用户确认授予之后应用才能获取相关的权限。为了避免每次都需要点击弹窗，可以使用 ADB 工具中的 AppOps 框架对软件永久授权，一劳永逸解决开局弹窗问题。

<!--more-->

如下图所示：开启和平精英的精彩时刻录制后，每次进入游戏对战时系统都会弹窗，只有点击「立即开始」和平精英才可以录制精彩时刻。

{% asset_img "pubg_casting.jpeg" '"要开始使用和平精英录制或投射内容吗？" "要开始使用和平精英录制或投射内容吗？"'%}

测试的设备是 OnePlus8T 手机，手机系统是 OxygenOS，安卓系统的版本是 11，测试的游戏是和平精英。


## 下载安装 ADB 工具

MacOS 环境下安装 ADB 使用 brew 执行下面命令[^1]即可：

```sh
brew install --cask android-platform-tools
```

其他操作平台上的 ADB 安装方法可以自行参考网上其他教程。


## 设置应用权限

AppOps 是安卓 4.3 加入的权限授权框架，安卓 6.0 之后引入了新的方案：Android Runtime Permission。但是 AppOps 的 API 仍然可以使用，只是没有图形管理界面。ADB 中的 AppOps 命令行管理工具也保留下来，并且可以生效。

确认手机和电脑连接成功之后，进入 ADB 的交互模式。对和平精英（包名：com.tencent.tmgp.pubgmhd）赋予 PROJECT_MEDIA 的权限。如果想撤回 PROJECT_MEDIA 权限，只需要把命令的 allow 改成 ignore 即可。

```sh
$ adb shell
OnePlus8T:/ $ appops set com.tencent.tmgp.pubgmhd PROJECT_MEDIA allow
OnePlus8T:/ $
```

同样的道理，对王者荣耀（包名：com.tencent.tmgp.sgame）执行类似的命令，理论上也是行得通，未实际测试。


[^1]: [android-platform-tools — Homebrew Formulae](https://formulae.brew.sh/cask/android-platform-tools)
